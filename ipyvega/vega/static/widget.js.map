{"version":3,"sources":["webpack://jupyter-vega/./src/widget.ts","webpack://jupyter-vega/external \"@jupyter-widgets/base\"","webpack://jupyter-vega/external \"nbextensions/jupyter-vega/index\"","webpack://jupyter-vega/webpack/bootstrap","webpack://jupyter-vega/webpack/startup"],"names":["VegaWidget","DOMWidgetView","viewElement","document","createElement","errorElement","this","el","appendChild","style","color","reembed","spec","JSON","parse","model","get","opt","result","vegaEmbed","loader","http","credentials","finalize","send","type","err","console","error","applyUpdate","update","Error","filter","Function","remove","newValues","insert","changeSet","view","changeset","change","key","runAsync","applyUpdates","message","updates","on","ev","checkWidgetUpdate","catch","textContent","String","module","exports","__WEBPACK_EXTERNAL_MODULE__612__","__WEBPACK_EXTERNAL_MODULE__563__","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","call"],"mappings":"8fAAA,eACA,SAwBA,MAAaA,UAAmB,EAAAC,cAAhC,c,oBAEE,KAAAC,YAAcC,SAASC,cAAc,OACrC,KAAAC,aAAeF,SAASC,cAAc,OAEhC,S,yCACJE,KAAKC,GAAGC,YAAYF,KAAKJ,aACzBI,KAAKD,aAAaI,MAAMC,MAAQ,MAChCJ,KAAKC,GAAGC,YAAYF,KAAKD,cAEzB,MAAMM,EAAU,IAAY,EAAD,gCACzB,MAAMC,EAAOC,KAAKC,MAAMR,KAAKS,MAAMC,IAAI,iBACjCC,EAAMJ,KAAKC,MAAMR,KAAKS,MAAMC,IAAI,gBAEtC,GAAY,MAARJ,EAIJ,IACE,MAAMM,QAAe,EAAAC,UAAUb,KAAKJ,YAAaU,EAAM,OAAF,QACnDQ,OAAQ,CAAEC,KAAM,CAAEC,YAAa,iBAC5BL,IAEDX,KAAKY,QACPZ,KAAKY,OAAOK,WAEdjB,KAAKY,OAASA,EACdZ,KAAKkB,KAAK,CAAEC,KAAM,YAClB,MAAOC,GACHpB,KAAKY,QACPZ,KAAKY,OAAOK,WAEdI,QAAQC,MAAMF,OAIZG,EAAqBC,GAAyB,EAAD,gCACjD,MAAMZ,EAASZ,KAAKY,OACpB,GAAc,MAAVA,EACF,MAAM,IAAIa,MAAM,8CAGlB,MAAMC,EAAS,IAAIC,SACjB,QACA,YAAcH,EAAOI,QAAU,SAAW,KAEtCC,EAAYL,EAAOM,QAAU,GAC7BC,EAAYnB,EAAOoB,KACtBC,YACAL,OAAOF,GACPI,OAAOD,SAEJjB,EAAOoB,KAAKE,OAAOV,EAAOW,IAAKJ,GAAWK,cAG5CC,EAAsBC,GAAiC,EAAD,gCAC1D,IAAK,MAAMd,KAAUc,EAAQC,cACrBhB,EAAYC,MAItBxB,KAAKS,MAAM+B,GAAG,sBAAuBnC,GACrCL,KAAKS,MAAM+B,GAAG,qBAAsBnC,GACpCL,KAAKS,MAAM+B,GAAG,cAAeC,IAC3B,MAAMH,EAzEZ,SAA2BG,GACzB,MAAe,UAAXA,EAAGtB,KACE,KAIFsB,EAmEaC,CAAkBD,GACnB,MAAXH,GAIJD,EAAaC,GAASK,OAAOvB,IAC3BpB,KAAKD,aAAa6C,YAAcC,OAAOzB,GACvCC,QAAQC,MAAMF,eAKZf,QA5EV,gB,QCzBAyC,EAAOC,QAAUC,G,QCAjBF,EAAOC,QAAUE,ICCbC,EAA2B,G,OAG/B,SAASC,EAAoBC,GAE5B,IAAIC,EAAeH,EAAyBE,GAC5C,QAAqBE,IAAjBD,EACH,OAAOA,EAAaN,QAGrB,IAAID,EAASI,EAAyBE,GAAY,CAGjDL,QAAS,IAOV,OAHAQ,EAAoBH,GAAUI,KAAKV,EAAOC,QAASD,EAAQA,EAAOC,QAASI,GAGpEL,EAAOC,QClBWI,CAAoB,M","file":"widget.js","sourcesContent":["import { DOMWidgetView } from \"@jupyter-widgets/base\";\nimport { vegaEmbed } from \"./index\";\nimport { Result } from \"vega-embed\";\n\ninterface WidgetUpdate {\n  key: string;\n  remove?: string;\n  insert?: any[];\n}\n\ninterface WidgetUpdateMessage {\n  type: \"update\";\n  updates: WidgetUpdate[];\n}\n\n// validate the ev object and cast it to the correct type\nfunction checkWidgetUpdate(ev: any): WidgetUpdateMessage | null {\n  if (ev.type != \"update\") {\n    return null;\n  }\n\n  // TODO: Fully validate ev and give a easy to understand error message if it is ill-formed\n  return ev as WidgetUpdateMessage;\n}\n\nexport class VegaWidget extends DOMWidgetView {\n  result?: Result;\n  viewElement = document.createElement(\"div\");\n  errorElement = document.createElement(\"div\");\n\n  async render() {\n    this.el.appendChild(this.viewElement);\n    this.errorElement.style.color = \"red\";\n    this.el.appendChild(this.errorElement);\n\n    const reembed = async () => {\n      const spec = JSON.parse(this.model.get(\"_spec_source\"));\n      const opt = JSON.parse(this.model.get(\"_opt_source\"));\n\n      if (spec == null) {\n        return;\n      }\n\n      try {\n        const result = await vegaEmbed(this.viewElement, spec, {\n          loader: { http: { credentials: \"same-origin\" } },\n          ...opt,\n        });\n        if (this.result) {\n          this.result.finalize();\n        }\n        this.result = result;\n        this.send({ type: \"display\" });\n      } catch (err) {\n        if (this.result) {\n          this.result.finalize();\n        }\n        console.error(err);\n      }\n    };\n\n    const applyUpdate = async (update: WidgetUpdate) => {\n      const result = this.result;\n      if (result == null) {\n        throw new Error(\"Internal error: no view attached to widget\");\n      }\n\n      const filter = new Function(\n        \"datum\",\n        \"return (\" + (update.remove || \"false\") + \")\"\n      );\n      const newValues = update.insert || [];\n      const changeSet = result.view\n        .changeset()\n        .remove(filter)\n        .insert(newValues);\n\n      await result.view.change(update.key, changeSet).runAsync();\n    };\n\n    const applyUpdates = async (message: WidgetUpdateMessage) => {\n      for (const update of message.updates) {\n        await applyUpdate(update);\n      }\n    };\n\n    this.model.on(\"change:_spec_source\", reembed);\n    this.model.on(\"change:_opt_source\", reembed);\n    this.model.on(\"msg:custom\", (ev: any) => {\n      const message = checkWidgetUpdate(ev);\n      if (message == null) {\n        return;\n      }\n\n      applyUpdates(message).catch((err: Error) => {\n        this.errorElement.textContent = String(err);\n        console.error(err);\n      });\n    });\n\n    // initial rendering\n    await reembed();\n  }\n}\n","module.exports = __WEBPACK_EXTERNAL_MODULE__612__;","module.exports = __WEBPACK_EXTERNAL_MODULE__563__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(891);\n"],"sourceRoot":""}